## Exploratory Data Analysis

```{r, include=FALSE}
train <- read.csv("../data/raw/bank_marketing_train.csv")
```

```{r}
datatable(head(train, 100), options = list(scrollX = TRUE))
str(train)
attach(train)
```

### Variable descriptions
#### Bank client data:
1. `X` (Integer): average yearly balance
2. `age` (Integer): age of the customer
3. `job` (Categorical): occupation
4. `marital` (Categorical): marital status
5. `education` (Categorical): education level
6. `default` (Binary): has credit in default?
7. `housing` (Binary): has housing loan?
8. `loan` (Binary): has personal loan?
9. `contact` (Categorical): contact communication type
10. `month` (Categorical): last contact month of year
11. `day_of_week` (Integer): last contact day of the week
12. `duration` (Integer): last contact duration, in seconds (numeric). Important note: this attribute highly affects the output target (e.g., if duration=0 then y='no'). Yet, the duration is not known before a call is performed. Also, after the end of the call y is obviously known. Thus, this input should only be included for benchmark purposes and should be discarded if the intention is to have a realistic predictive model

#### Other attributes:
13. `campaign` (Integer): number of contacts performed during this campaign and for this client (numeric, includes last contact)
14. `pdays` (Integer): number of days that passed by after the client was last contacted from a previous campaign (numeric; -1 means client was not previously contacted)
15. `previous` (Integer): number of contacts performed before this campaign and for this client
16. `poutcome` (Categorical): outcome of the previous marketing campaign (categorical: 'failure','nonexistent','success')

#### Social and economic context attributes
17. `emp.var.rate` (Integer): employment variation rate - quarterly indicator
18. `cons.price.idx` (Integer): consumer price index - monthly indicator
19. `cons.conf.idx` (Integer): consumer confidence index - monthly indicator
20. `euribor3m` (Integer): euribor 3 month rate - daily indicator
21. `nr.employed` (Integer): number of employees - quarterly indicator

#### Output variable (desired target)
22. `subscribed` (Binary): has the client subscribed a term deposit?

Source: [UCI Machine Learning Repository](https://archive.ics.uci.edu/dataset/222/bank+marketing)

```{r}
vis_dat(train)
```

```{r}
corrplot(cor(train[, c("X", "age", "duration", "campaign", "pdays", "previous", "emp.var.rate", "cons.price.idx", "cons.conf.idx", "euribor3m", "nr.employed")]), method="pie")
```

```{r}
plot_ly(train, x = job, y = age, type = 'box', color = job)

plot_ly(train, x = subscribed, type = 'histogram')


```


```{r}
ggplot(train, aes(x = education, fill = factor(subscribed))) +
  geom_bar(position = "fill") +ylab("frequency") +  
  ylab("Proportion") +
  scale_fill_discrete(name = "Subscribed") +  
  xlab("Education") +
  geom_hline(yintercept = 0.5, linetype = "dashed", color = "red") +
  theme_minimal()



ggplot(train, aes(x = poutcome, fill = factor(subscribed))) +
  geom_bar(position = "fill") +ylab("frequency") +  
  ylab("Proportion") +
  scale_fill_discrete(name = "Subscribed") +  
  xlab("Outcome of previous campaign") +
  geom_hline(yintercept = 0.5, linetype = "dashed", color = "red") +
  theme_minimal()

ggplot(train, aes(x = cut(age, breaks = 4), fill = factor(subscribed))) +
  geom_bar(position = "fill") +ylab("frequency") +  
  ylab("Proportion") +
  scale_fill_discrete(name = "Subscribed") +  
  xlab("Age range") +
  geom_hline(yintercept = 0.5, linetype = "dashed", color = "red") +
  theme_minimal()

ggplot(train, aes(x = job, fill = factor(subscribed))) +
  geom_bar(position = "fill") +ylab("frequency") +  
  ylab("Proportion") +
  scale_fill_discrete(name = "Subscribed") +  
  xlab("Job") +
  geom_hline(yintercept = 0.5, linetype = "dashed", color = "red") +
  theme_minimal()


ggplot(train, aes(x=cut(cons.price.idx, breaks=3), fill = factor(subscribed))) +
  geom_bar(position = "fill") +ylab("frequency") +  
  ylab("Proportion") +
  scale_fill_discrete(name = "Subscribed") +  
  xlab("Consumer price index") +
  geom_hline(yintercept = 0.5, linetype = "dashed", color = "red") +
  theme_minimal()

ggplot(train, aes(x=cut(cons.conf.idx, breaks=3), fill = factor(subscribed))) +
  geom_bar(position = "fill") +ylab("frequency") +  
  ylab("Proportion") +
  scale_fill_discrete(name = "Subscribed") +  
  xlab("Consumer Confidence Index") +
  geom_hline(yintercept = 0.5, linetype = "dashed", color = "red") +
  theme_minimal()
```



```{r}
ggpairs(train[, c("age", "duration", "campaign", "pdays", "previous", "emp.var.rate", "cons.price.idx", "cons.conf.idx", "euribor3m", "nr.employed")], columns = 1:10, 
                 lower = list(continuous = wrap("points", alpha = 0.5, color = "darkred", size=0.5)),
                 title='Scatterplot', axisLabels='none')
```



